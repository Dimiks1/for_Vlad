@page
@{
    ViewData["Title"] = "ToolDrop - –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤";
}

<!-- Hero Section -->
<div class="hero-section" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%), url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 1200 600%22><rect fill=%22%23333%22 width=%221200%22 height=%22600%22/></svg>'); background-size: cover; background-position: center; padding: 150px 0; color: white; text-align: center;">
    <div class="container">
        <h1 class="display-3 fw-bold mb-4">‚öîÔ∏è ToolDrop</h1>
        <p class="lead mb-4" style="font-size: 24px;">–ú–∞–≥–∞–∑–∏–Ω —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>
        <p class="mb-5" style="font-size: 18px;">–û—Ä—É–∂–∏–µ, –±—Ä–æ–Ω—è, –∑–µ–ª—å—è –∏ —Ä–µ–¥–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–ª—è –≤–∞—à–µ–π –ª—é–±–∏–º–æ–π –∏–≥—Ä—ã</p>
        <a href="/catalog" class="btn btn-light btn-lg">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ üõí</a>
    </div>
</div>

<!-- Features Section -->
<div class="container my-5">
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">‚ö° –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h5>
                    <p class="card-text">–ü–æ–ª—É—á–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã. –ù–∏–∫–∞–∫–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫!</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h5>
                    <p class="card-text">–ó–∞—â–∏—Ç–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞. –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">üíé –†–µ–¥–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã</h5>
                    <p class="card-text">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –≤–µ—â–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- About Section -->
<div class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">–û ToolDrop</h2>
        <div class="row">
            <div class="col-md-6">
                <h4>üéÆ –ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º?</h4>
                <p>
                    ToolDrop - —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏ –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
                    –ú—ã —Å–æ–±—Ä–∞–ª–∏ –ª—É—á—à—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é —Ä–µ–¥–∫–∏—Ö –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö –≤–µ—â–∏ –¥–ª—è –≤–∞—à–∏—Ö –ª—é–±–∏–º—ã—Ö –∏–≥—Ä.
                </p>
                <p>–ö–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç –æ—Ç–æ–±—Ä–∞–Ω –≤—Ä—É—á–Ω—É—é –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å.</p>
            </div>
            <div class="col-md-6">
                <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <ul class="list-unstyled">
                    <li>‚úÖ <strong>5000+</strong> –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</li>
                    <li>‚úÖ <strong>10000+</strong> —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</li>
                    <li>‚úÖ <strong>24/7</strong> –ø–æ–¥–¥–µ—Ä–∂–∫–∞</li>
                    <li>‚úÖ <strong>100%</strong> –≥–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- CTA Section -->
<div class="bg-primary text-white py-5 text-center">
    <div class="container">
        <h2 class="mb-4">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</h2>
        <p class="lead mb-4">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å 100 —Ä—É–±–ª–µ–π –Ω–∞ —Å—á—ë—Ç!</p>
        <button class="btn btn-light btn-lg" onclick="openAuthModal()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
</div>

<!-- Auth Modal (—Ç–æ–ª—å–∫–æ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã) -->
<div class="modal fade" id="authModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="authTitle">–í—Ö–æ–¥</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- –í—Ö–æ–¥ Form -->
                <div id="loginForm">
                    <div class="mb-3">
                        <label class="form-label">–ù–∏–∫–Ω–µ–π–º</label>
                        <input type="text" class="form-control" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-primary w-100 mb-3" onclick="login()">–í–æ–π—Ç–∏</button>
                    <div class="text-center mb-3">
                        <a href="#" onclick="showForgotPassword()">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                    </div>
                    <hr>
                    <p class="text-center">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="switchToRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a></p>
                </div>

                <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Form -->
                <div id="registerForm" style="display: none;">
                    <div class="mb-3">
                        <label class="form-label">–ù–∏–∫–Ω–µ–π–º</label>
                        <input type="text" class="form-control" id="regUsername" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="regEmail" placeholder="–í–∞—à email">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="regPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-primary w-100 mb-3" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    <hr>
                    <p class="text-center">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="switchToLogin()">–í–æ–π–¥–∏—Ç–µ</a></p>
                </div>

                <!-- Forgot Password -->
                <div id="forgotPasswordForm" style="display: none;">
                    <div class="alert alert-info text-center">
                        <h5>üò¢ –ü–æ–ø–ª–∞—á—å –æ–± —ç—Ç–æ–º</h5>
                        <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.</p>
                    </div>
                    <button class="btn btn-secondary w-100" onclick="switchToLogin()">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function updateNavigation() {
        const user = JSON.parse(localStorage.getItem('user'));
        const authBtn = document.getElementById('authBtn');

        if (user) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ "–ü—Ä–æ—Ñ–∏–ª—å"
            if (authBtn) {
                authBtn.innerHTML = `
                    <div class="dropdown">
                        <button class="btn btn-auth dropdown-toggle" type="button" id="profileDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            üë§ ${user.username}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                            <li class="dropdown-header">
                                <div class="fw-bold text-dark">${user.username}</div>
                                <div class="user-balance mt-2">–ë–∞–ª–∞–Ω—Å: ${user.balance} ‚ÇΩ</div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-dark" href="/profile"><i class="fas fa-user-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-dark" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</a></li>
                        </ul>
                    </div>
                `;
            }
        } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
            if (authBtn) {
                authBtn.innerHTML = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                authBtn.setAttribute('onclick', 'openAuthModal()');
            }
        }
    }

    let authModal;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        updateNavigation();
    });

    function openAuthModal() {
        authModal = new bootstrap.Modal(document.getElementById('authModal'));
        switchToLogin();
        authModal.show();
    }

    function switchToLogin() {
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('forgotPasswordForm').style.display = 'none';
        document.getElementById('authTitle').textContent = '–í—Ö–æ–¥';
    }

    function switchToRegister() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'block';
        document.getElementById('forgotPasswordForm').style.display = 'none';
        document.getElementById('authTitle').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
    }

    function showForgotPassword() {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('forgotPasswordForm').style.display = 'block';
        document.getElementById('authTitle').textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è';
    }

    async function login() {
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;

        if (!username || !password) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            return;
        }

        try {
            const response = await fetch('/api/account/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('user', JSON.stringify(data.user));

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å—Ä–∞–∑—É
                if (authModal) {
                    authModal.hide();
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                updateNavigation();

                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                location.reload();
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
    }

    async function register() {
        const username = document.getElementById('regUsername').value;
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const passwordConfirm = document.getElementById('regPasswordConfirm').value;

        if (!username || !email || !password || !passwordConfirm) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            return;
        }

        if (password !== passwordConfirm) {
            alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
            return;
        }

        try {
            const response = await fetch('/api/account/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password })
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('user', JSON.stringify(data.user));

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å—Ä–∞–∑—É
                if (authModal) {
                    authModal.hide();
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                updateNavigation();

                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                location.reload();
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
    }

    // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
    async function logout() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
            try {
                const response = await fetch('/api/account/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    localStorage.removeItem('user');
                    localStorage.removeItem('cart');
                    updateNavigation();
                    alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                    location.href = '/';
                } else {
                    const data = await response.json();
                    alert(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }
        }
    }
</script>